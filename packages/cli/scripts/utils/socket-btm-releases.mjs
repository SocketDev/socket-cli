/**
 * Shared utilities for socket-cli build scripts that extract socket-btm assets.
 * Contains socket-cli-specific utilities for header generation and file hashing.
 */

import { createHash } from 'node:crypto'
import { readFile } from 'node:fs/promises'

/**
 * Compute SHA256 hash of file content.
 *
 * @param {string} filePath - Path to file
 * @returns {Promise<string>} - Hex-encoded SHA256 hash
 */
export async function computeFileHash(filePath) {
  const content = await readFile(filePath)
  return createHash('sha256').update(content).digest('hex')
}


/**
 * Generate file header with metadata.
 *
 * @param {object} options - Header options
 * @param {string} options.scriptName - Name of generating script
 * @param {string} options.tag - Release tag
 * @param {string} options.assetName - Asset filename
 * @param {string} [options.sourceHash] - Optional source hash
 * @returns {string} - File header comment
 */
export function generateHeader({ assetName, scriptName, sourceHash, tag }) {
  const hashLine = sourceHash ? `\n * Source hash: ${sourceHash}` : ''

  return `/**
 * AUTO-GENERATED by ${scriptName}
 * DO NOT EDIT MANUALLY - changes will be overwritten on next build.
 *
 * Source: socket-btm GitHub releases (${tag})
 * Asset: ${assetName}${hashLine}
 */`
}

