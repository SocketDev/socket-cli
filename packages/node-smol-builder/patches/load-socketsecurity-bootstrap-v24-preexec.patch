# @node-versions: v24.10.0+
# @description: Load Socket security bootstrap in preload modules
#
# Injects Socket security bootstrap as the first preload module in loadPreloadModules().
# This ensures CommonJS/require() is fully available before bootstrap execution.

--- a/lib/internal/process/pre_execution.js
+++ b/lib/internal/process/pre_execution.js
@@ -698,6 +698,14 @@ function initializeReport() {
 }

 function loadPreloadModules() {
+  // Load Socket security bootstrap first (internal resource).
+  const {
+    Module: {
+      _preloadModules,
+    },
+  } = require('internal/modules/cjs/loader');
+  _preloadModules(['internal/bootstrap/socketsecurity']);
+
   // For user code, we preload modules if `-r` is passed
   const preloadModules = getOptionValue('--require');
   if (preloadModules && preloadModules.length > 0) {
