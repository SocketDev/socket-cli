# @node-versions: v24.10.0+
# @description: Load Socket security bootstrap (minimal injection approach)
#
# This patch adds a single require() call to load the Socket bootstrap.
# The actual bootstrap loader logic lives in lib/internal/socketsecurity_bootstrap_loader.js
# (added via the additions/ directory during build).
#
# Benefits of this approach:
# - Minimal patch footprint (1 line vs 21,000+ lines)
# - Bootstrap loader code can have full comments and formatting
# - Easier to maintain and understand
# - Cleaner separation of concerns

--- a/lib/internal/process/pre_execution.js
+++ b/lib/internal/process/pre_execution.js
@@ -675,6 +675,9 @@ function runEmbedderPreload() {
 }

 function loadPreloadModules() {
+  // Load Socket security bootstrap (loader added via build additions/).
+  require('internal/socketsecurity_bootstrap_loader')();
+
   // For user code, we preload modules if `-r` is passed
   const preloadModules = getOptionValue('--require');
   if (preloadModules && preloadModules.length > 0) {
